# CODEV План: Кредитный Эксперт Бот (Credit Expert Bot)

> Протокол: SPIDER-SOLO
> Связанная спецификация: `codev/specs/0005-credit-expert-bot.md`
> Контекст: Реализация нового бота для ниши "Банкротство/Списание долгов" по предоставленному скрипту продаж.

## Цели
- Создать Telegram-бота, который квалифицирует лидов для услуг по списанию долгов.
- Реализовать строгий сценарий диалога: Приветствие -> Квалификация -> Закрытие на звонок.
- Обеспечить обработку возражений (Цена, "Подумаю", Конкуренты) согласно скрипту.
- Сохранять всех пользователей и историю переписки в MySQL для аналитики и CRM.
- Использовать OpenAI для генерации естественных ответов в рамках заданного системного промпта.

## Фазы

**Фаза 1: Реализация ядра и базы данных (Выполнено)**
- Объектив: Создать работающего бота с подключением к БД и AI.
- Задачи:
  - Реализовать `credit_expert_bot.py` на базе `telethon`.
  - Настроить схему MySQL (таблицы `bot_users`, `bot_messages`, `bot_sessions`).
  - Интегрировать `OpenAIClient` с системным промптом "Кредитный эксперт Дарья".
  - Реализовать логику сохранения сообщений и управления сессиями.
- Доставляемое: Рабочий скрипт бота.

**Фаза 2: Тестирование и QA (Выполнено)**
- Объектив: Гарантировать соответствие логики бота скрипту продаж через BDD тесты.
- Задачи:
  - Создать feature-файл `features/credit_expert_bot.feature` с сценариями (Приветствие, Квалификация, Возражения).
  - Реализовать шаги тестирования в `features/steps/credit_expert_bot_steps.py` с моками БД и AI.
  - Прогнать тесты и убедиться в корректности работы логики.
- Доставляемое: Зеленые тесты `behave`.

**Фаза 3: Развертывание и Мониторинг (Планируется)**
- Объектив: Запустить бота в продакшн окружении.
- Задачи:
  - Добавить переменные окружения (`CREDIT_EXPERT_BOT_TOKEN`) в `.env`.
  - Настроить systemd юнит или Docker Compose сервис.
  - Подключить мониторинг (например, через `n8n_monitor.py` или аналогичный механизм).
- Доставляемое: Запущенный сервис бота.

## Артефакты
- Код: `credit_expert_bot.py`
- Тесты: `features/credit_expert_bot.feature`, `features/steps/credit_expert_bot_steps.py`
- План: `codev/plans/0005-credit-expert-bot.md`
