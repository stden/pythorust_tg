# CODEV Спецификация: Кредитный Эксперт Бот

> Протокол: SPIDER-SOLO
> Статус: Draft

## Проблема
Необходимо автоматизировать первичную квалификацию лидов в нише "Банкротство физических лиц" и "Списание долгов".
Текущий процесс требует ручного участия для сбора базовой информации, что неэффективно.
Цель - получить номер телефона клиента для консультации, следуя строгому скрипту.

## Решение
Telegram-бот "Кредитный Эксперт" (Дарья), который ведет диалог по заданному сценарию.

### Функциональные требования
1. **Приветствие**:
   - Мгновенный ответ на первое сообщение.
   - Представление (Дарья, кредитный эксперт).
   - Запрос имени клиента.

2. **Квалификация**:
   - Вопрос о стадии принятия решения (решил/изучает).
   - Сбор информации (ситуация, просрочки, коллекторы, сумма долга, тип кредиторов).
   - Эмпатия после каждого ответа ("Понимаю, тяжело").

3. **Закрытие на звонок**:
   - Предложение созвониться для плана действий.
   - Аргументация: бесплатно, 10-15 минут, ни к чему не обязывает.

4. **Работа с возражениями**:
   - Обработка типовых возражений: "Расскажите сначала", "Сколько стоит", "Подумаю", "Где находитесь", "Другая компания", "Можно в переписке".
   - В каждом случае - возврат к предложению созвониться.

5. **Интеграция**:
   - Сохранение данных пользователя и истории переписки в MySQL.
   - Использование LLM (OpenAI) для генерации реплик, соответствующих тону и скрипту.

### Технический дизайн
- **Язык**: Python 3.11+
- **Библиотеки**: `telethon` (Telegram Client), `openai` (LLM), `pymysql` (Database).
- **База данных**: MySQL (таблицы `bot_users`, `bot_messages`, `bot_sessions`).
- **Архитектура**:
  - `CreditExpertBot` класс управляет подключением и событиями.
  - `MySQLLogger` класс управляет сохранением данных.
  - `OpenAIClient` используется для генерации ответов с системным промптом, содержащим скрипт.

## Критерии успеха
- Бот корректно ведет диалог по скрипту.
- Все сообщения сохраняются в БД.
- Тесты (BDD) покрывают основные сценарии и возражения.
