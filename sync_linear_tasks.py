#!/usr/bin/env python3
"""
–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–¥–∞—á –≤ Linear –Ω–∞ –æ—Å–Ω–æ–≤–µ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã.
–°–æ–∑–¥–∞—ë—Ç –∑–∞–¥–∞—á–∏ –∏–∑ –∞–Ω–∞–ª–∏–∑–æ–≤ —á–∞—Ç–æ–≤ –∏ –ø–ª–∞–Ω–æ–≤ –ø—Ä–æ–µ–∫—Ç–æ–≤.
"""

import os
import sys
from linear_client import LinearClient, LinearError
from dotenv import load_dotenv

load_dotenv()

TEAM_KEY = (os.getenv("LINEAR_TEAM_KEY") or "").strip()
if not TEAM_KEY:
    print("‚ùå LINEAR_TEAM_KEY –Ω–µ –∑–∞–¥–∞–Ω (–¥–æ–±–∞–≤—å—Ç–µ –≤ .env).")
    print("   –ü–æ–ª—É—á–∏—Ç–µ API –∫–ª—é—á –Ω–∞: https://linear.app/settings/api")
    sys.exit(1)


# –ó–∞–¥–∞—á–∏ –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å–µ—Å—Å–∏–∏ —Ä–∞–±–æ—Ç—ã
TASKS = {
    "completed": [
        # –ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ (–¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏)
        (
            "‚úÖ –ê–Ω–∞–ª–∏–∑ —á–∞—Ç–∞ –•–∞—Ä–∞",
            "–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω —á–∞—Ç –¥—É—Ö–æ–≤–Ω–æ–≥–æ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞ –•–∞—Ä–∞ (369 —Å–æ–æ–±—â–µ–Ω–∏–π)\n\n"
            "–†–µ–∑—É–ª—å—Ç–∞—Ç: —Å–æ–∑–¥–∞–Ω –ø—Ä–æ–º–ø—Ç –¥–ª—è –¥–∏–∑–∞–π–Ω–∞ —Å–∞–π—Ç–∞\n"
            "–§–∞–π–ª: prompts/hara_website_design.md\n\n"
            "–í–∫–ª—é—á–∞–µ—Ç:\n"
            "- –¶–≤–µ—Ç–æ–≤—É—é –ø–∞–ª–∏—Ç—Ä—É (–∑–æ–ª–æ—Ç–æ–π, —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π, –∏–∑—É–º—Ä—É–¥–Ω—ã–π)\n"
            "- –¢–∏–ø–æ–≥—Ä–∞—Ñ–∏–∫—É (Playfair Display, Inter/Raleway)\n"
            "- –°—Ç—Ä—É–∫—Ç—É—Ä—É –∏–∑ 6 —Å—Ç—Ä–∞–Ω–∏—Ü\n"
            "- –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã (–≥–∞–¥–∞–Ω–∏–µ, –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –Ω—É–º–µ—Ä–æ–ª–æ–≥–∏–∏)\n"
            "- 10 –¥–µ—Ç–∞–ª—å–Ω—ã—Ö —Å–µ–∫—Ü–∏–π",
            4,
        ),
        (
            "‚úÖ –ê–Ω–∞–ª–∏–∑ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–µ–π –≤–∞–π–±–∫–æ–¥–µ—Ä–æ–≤",
            "–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω —á–∞—Ç –≤–∞–π–±–∫–æ–¥–µ—Ä—ã (475 —Å–æ–æ–±—â–µ–Ω–∏–π –∑–∞ 2 –¥–Ω—è)\n\n"
            "–†–µ–∑—É–ª—å—Ç–∞—Ç: –≤—ã—è–≤–ª–µ–Ω–æ 12 –ø—Ä–æ–¥—É–∫—Ç–æ–≤—ã—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π\n"
            "–§–∞–π–ª: analysis_results/vibecoders_needs_analysis.md\n\n"
            "–¢–æ–ø-3 –∏–¥–µ–∏ —Å –≤—ã—Å–æ–∫–∏–º –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª–æ–º:\n"
            "1. Figma Pixel-Perfect Plugin ($15-50/–º–µ—Å)\n"
            "2. VoiceGPT Pro —Å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–æ–º ($20-40/–º–µ—Å)\n"
            "3. CharacterHub - open source character AI\n\n"
            "–ü—Ä–æ–≥–Ω–æ–∑: $1,750-13,500 MRR –∑–∞ 6 –º–µ—Å—è—Ü–µ–≤",
            4,
        ),
    ],
    "figma_plugin": [],
    "hara_website": [
        (
            "–î–∏–∑–∞–π–Ω —Å–∞–π—Ç–∞ –•–∞—Ä–∞: –í—ã–±–æ—Ä –¥–∏–∑–∞–π–Ω–µ—Ä–∞/–∞–≥–µ–Ω—Ç—Å—Ç–≤–∞",
            "–ù–∞–π—Ç–∏ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∏–∑–∞–π–Ω–∞\n\n"
            "–û–ø—Ü–∏–∏:\n"
            "1. Freelance –¥–∏–∑–∞–π–Ω–µ—Ä (Behance, Dribbble)\n"
            "2. –î–∏–∑–∞–π–Ω-—Å—Ç—É–¥–∏—è —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—â–∞—è—Å—è –Ω–∞ wellness\n"
            "3. AI-–≥–µ–Ω–µ—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ Midjourney + –¥–æ—Ä–∞–±–æ—Ç–∫–∞\n"
            "4. –ö–æ–Ω–∫—É—Ä—Å –Ω–∞ 99designs\n\n"
            "–ë—é–¥–∂–µ—Ç: $1,500-5,000\n"
            "–†–µ—Ñ–µ—Ä–µ–Ω—Å—ã: Gaia.com, The Wild Unknown\n"
            "–ü—Ä–æ–º–ø—Ç: prompts/hara_website_design.md",
            2,
        ),
        (
            "–î–∏–∑–∞–π–Ω —Å–∞–π—Ç–∞ –•–∞—Ä–∞: –ö–æ–ª–æ–¥–∞ –∫–∞—Ä—Ç –•–ê–†–ê –ø—Ä–æ–¥—É–∫—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞",
            "–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–¥—É–∫—Ç–æ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –ø—Ä–µ–¥–∑–∞–∫–∞–∑–∞ –∫–æ–ª–æ–¥—ã\n\n"
            "–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:\n"
            "- –ì–∞–ª–µ—Ä–µ—è –ø—Ä–∏–º–µ—Ä–æ–≤ –∫–∞—Ä—Ç\n"
            "- –û–ø–∏—Å–∞–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π –∫–∞—Ä—Ç\n"
            "- –§–æ—Ä–º–∞ –ø—Ä–µ–¥–∑–∞–∫–∞–∑–∞\n"
            "- Countdown —Ç–∞–π–º–µ—Ä –¥–æ 10.12\n"
            "- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –æ–ø–ª–∞—Ç—ã\n\n"
            "–î–µ–¥–ª–∞–π–Ω: –¥–æ 10.12 (–≤—ã–ø—É—Å–∫ –∫–æ–ª–æ–¥—ã)\n"
            "–¶–µ–Ω–∞ –∫–æ–ª–æ–¥—ã: TBD",
            1,
        ),
        (
            "–î–∏–∑–∞–π–Ω —Å–∞–π—Ç–∞ –•–∞—Ä–∞: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è —Ä–µ—Ç—Ä–∏—Ç–æ–≤",
            "–î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –æ–Ω–ª–∞–π–Ω-—Ä–µ—Ç—Ä–∏—Ç–æ–≤ –∏ —ç—Ñ–∏—Ä–æ–≤\n\n"
            "–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:\n"
            "- –ö–∞–ª–µ–Ω–¥–∞—Ä—å —Å–æ–±—ã—Ç–∏–π\n"
            "- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ —Ä–µ—Ç—Ä–∏—Ç\n"
            "- Telegram-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¥–ª—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π\n"
            "- –ü—Ä–æ—Ñ–∏–ª–∏ –≤–µ–¥—É—â–∏—Ö (–ò—Ä–∏–Ω–∞, –ò–Ω–Ω–∞, Anna)\n\n"
            "–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏: Google Calendar API / Calendly",
            3,
        ),
    ],
    "voice_gpt_pro": [
        (
            "VoiceGPT Pro: Research –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤",
            "–ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ä–µ—à–µ–Ω–∏—è –≥–æ–ª–æ—Å–æ–≤—ã—Ö AI\n\n"
            "–ö–æ–Ω–∫—É—Ä–µ–Ω—Ç—ã:\n"
            "- ChatGPT Voice Mode\n"
            "- Claude mobile voice\n"
            "- Perplexity Voice\n"
            "- Google Assistant with Gemini\n\n"
            "–ê–Ω–∞–ª–∏–∑:\n"
            "- –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è\n"
            "- –¶–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ\n"
            "- –û—Ç–∑—ã–≤—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π\n"
            "- Gap analysis\n\n"
            "–í—Ä–µ–º—è: 4-6 —á–∞—Å–æ–≤",
            3,
        ),
        (
            "VoiceGPT Pro: –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è",
            "–ù–∞–ø–∏—Å–∞—Ç—å –¥–µ—Ç–∞–ª—å–Ω—ã–π tech spec –¥–ª—è –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ AI\n\n"
            "–°–µ–∫—Ü–∏–∏:\n"
            "- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (STT + LLM + TTS + Web Search)\n"
            "- –í—ã–±–æ—Ä –º–æ–¥–µ–ª–µ–π (Whisper, GPT-4o, ElevenLabs)\n"
            "- –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ costs\n"
            "- Mobile app vs Web app\n"
            "- –°—Ç—Ä–∞—Ç–µ–≥–∏—è –º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏–∏\n\n"
            "–§–æ—Ä–º–∞—Ç: codev/specs/voice-gpt-pro.md\n"
            "–í—Ä–µ–º—è: 8-10 —á–∞—Å–æ–≤",
            3,
        ),
    ],
    "character_hub": [
        (
            "CharacterHub: –ê–Ω–∞–ª–∏–∑ —Ä—ã–Ω–∫–∞ Character.AI",
            "–ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å —Ä—ã–Ω–æ–∫ character AI –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏\n\n"
            "–ê–Ω–∞–ª–∏–∑:\n"
            "- Character.AI business model\n"
            "- –†–∞–∑–º–µ—Ä —Ä—ã–Ω–∫–∞ –∏ –ø—Ä–æ–≥–Ω–æ–∑—ã\n"
            "- Open source –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã\n"
            "- Grok Aurora —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª\n"
            "- –ü–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏ –¥–µ—Å–∫—Ç–æ–ø-–≤–µ—Ä—Å–∏–∏ –¥–ª—è —Å—Ç—Ä–∏–º–µ—Ä–æ–≤\n\n"
            "–í—ã–≤–æ–¥ –∏–∑ –∞–Ω–∞–ª–∏–∑–∞ –≤–∞–π–±–∫–æ–¥–µ—Ä–æ–≤:\n"
            "> '–ú–Ω–µ –∫–∞–∫ –∏–¥–µ—è –æ—á–µ–Ω—å –∑–∞—à–ª–æ! –ù–æ –Ω–µ –≥–æ—Ç–æ–≤ —Ä–∞–¥–∏ —ç—Ç–æ–≥–æ –æ–ø–ª–∞—á–∏–≤–∞—Ç—å –ì—Ä–æ–∫)'\n\n"
            "–í—Ä–µ–º—è: 6-8 —á–∞—Å–æ–≤",
            4,
        ),
    ],
}


def create_tasks_in_linear(client: LinearClient, dry_run: bool = False):
    """–°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á–∏ –≤ Linear."""
    created = 0
    errors = 0
    skipped = 0

    print("=" * 60)
    print("üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–¥–∞—á —Å Linear")
    print("=" * 60)
    print(f"Team: {TEAM_KEY}")
    print(f"Dry run: {dry_run}")
    print()

    for category, tasks in TASKS.items():
        print(f"\nüìÅ –ö–∞—Ç–µ–≥–æ—Ä–∏—è: {category}")
        print("-" * 60)

        for title, description, priority in tasks:
            # –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ (—Ç–æ–ª—å–∫–æ –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏)
            if category == "completed":
                print(f"  ‚è≠Ô∏è  {title} (–∞—Ä—Ö–∏–≤–Ω–∞—è)")
                skipped += 1
                continue

            if dry_run:
                print(f"  üîç [DRY RUN] {title}")
                print(f"     Priority: {priority}")
                print(f"     Description preview: {description[:100]}...")
                continue

            try:
                issue = client.create_issue(
                    team_key=TEAM_KEY,
                    title=title,
                    description=f"{description}\n\n---\n–ö–∞—Ç–µ–≥–æ—Ä–∏—è: {category}\n–°–æ–∑–¥–∞–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑ sync_linear_tasks.py",
                    priority=priority,
                )
                print(f"  ‚úÖ {issue['identifier']}: {title}")
                print(f"     URL: {issue['url']}")
                created += 1
            except LinearError as e:
                print(f"  ‚ùå {title}")
                print(f"     –û—à–∏–±–∫–∞: {e}")
                errors += 1

    print(f"\n{'=' * 60}")
    print("üìä –†–µ–∑—É–ª—å—Ç–∞—Ç:")
    print(f"   ‚úÖ –°–æ–∑–¥–∞–Ω–æ: {created} –∑–∞–¥–∞—á")
    print(f"   ‚ùå –û—à–∏–±–æ–∫: {errors}")
    print(f"   ‚è≠Ô∏è  –ü—Ä–æ–ø—É—â–µ–Ω–æ: {skipped} (–∞—Ä—Ö–∏–≤–Ω—ã–µ)")
    print("=" * 60)

    return created, errors, skipped


def main():
    import argparse

    parser = argparse.ArgumentParser(description="–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–¥–∞—á –≤ Linear")
    parser.add_argument(
        "--dry-run", action="store_true", help="–ü–æ–∫–∞–∑–∞—Ç—å —á—Ç–æ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–æ –±–µ–∑ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á"
    )
    parser.add_argument("--category", type=str, help="–°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á–∏ —Ç–æ–ª—å–∫–æ –∏–∑ —É–∫–∞–∑–∞–Ω–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏")

    args = parser.parse_args()

    # –§–∏–ª—å—Ç—Ä –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–æ
    tasks_to_process = TASKS
    if args.category:
        if args.category not in TASKS:
            print(f"‚ùå –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è: {args.category}")
            print(f"   –î–æ—Å—Ç—É–ø–Ω—ã–µ: {', '.join(TASKS.keys())}")
            sys.exit(1)

        tasks_to_process = {args.category: TASKS[args.category]}

    try:
        client = LinearClient()
    except LinearError as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Linear: {e}")
        print("\n–î–æ–±–∞–≤—å—Ç–µ LINEAR_API_KEY –≤ .env —Ñ–∞–π–ª:")
        print("1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://linear.app/settings/api")
        print("2. –°–æ–∑–¥–∞–π—Ç–µ Personal API Key")
        print("3. –î–æ–±–∞–≤—å—Ç–µ –≤ .env: LINEAR_API_KEY=lin_api_xxx")
        sys.exit(1)

    # –í—Ä–µ–º–µ–Ω–Ω–æ –∑–∞–º–µ–Ω—è–µ–º TASKS –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
    original_tasks = TASKS
    if args.category:
        TASKS.clear()
        TASKS.update(tasks_to_process)

    created, errors, skipped = create_tasks_in_linear(client, dry_run=args.dry_run)

    # –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏
    TASKS.clear()
    TASKS.update(original_tasks)

    if args.dry_run:
        print("\nüí° –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–µ–∑ --dry-run –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á –≤ Linear")

    sys.exit(0 if errors == 0 else 1)


if __name__ == "__main__":
    main()
