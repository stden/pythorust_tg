# language: ru

Функционал: BFL Sales Bot - AI-консультант по массажным креслам
  Как менеджер по продажам
  Я хочу использовать AI-бота для консультирования клиентов
  Чтобы увеличить продажи массажных кресел

  Предыстория:
    Допустим MySQL база данных настроена
    И OpenAI клиент инициализирован

  # ========== Работа с пользователями ==========

  Сценарий: Сохранение нового пользователя
    Допустим пользователь с id 123456 и именем "Иван"
    Когда бот сохраняет пользователя в базу данных
    Тогда пользователь существует в таблице "bot_users"
    И имя пользователя равно "Иван"

  Сценарий: Обновление существующего пользователя
    Допустим пользователь с id 123456 уже в базе данных
    И пользователь изменил username на "ivan_new"
    Когда бот сохраняет пользователя в базу данных
    Тогда username пользователя обновлён на "ivan_new"

  # ========== Работа с сообщениями ==========

  Сценарий: Сохранение входящего сообщения
    Допустим пользователь с id 123456 отправил сообщение "Привет!"
    Когда бот сохраняет сообщение в базу данных
    Тогда сообщение сохранено с направлением "incoming"
    И текст сообщения равен "Привет!"

  Сценарий: Сохранение исходящего сообщения
    Допустим бот отправляет ответ пользователю 123456
    Когда бот сохраняет исходящее сообщение "Здравствуйте!"
    Тогда сообщение сохранено с направлением "outgoing"

  # ========== Работа с сессиями ==========

  Сценарий: Создание новой сессии при /start
    Допустим пользователь с id 123456 отправил /start
    Когда бот создаёт новую сессию
    Тогда сессия создана со статусом "greeting"
    И сессия активна

  Сценарий: Завершение предыдущей сессии при новом /start
    Допустим у пользователя 123456 есть активная сессия
    Когда пользователь отправляет /start повторно
    Тогда предыдущая сессия деактивирована
    И создана новая активная сессия

  # ========== История диалога ==========

  Сценарий: Получение истории диалога
    Допустим пользователь 123456 отправил 5 сообщений
    И бот ответил на каждое
    Когда запрашивается история диалога с лимитом 20
    Тогда возвращается 10 сообщений
    И сообщения отсортированы по времени

  Сценарий: Лимит истории диалога
    Допустим пользователь 123456 имеет 50 сообщений в истории
    Когда запрашивается история диалога с лимитом 10
    Тогда возвращается только 10 последних сообщений

  # ========== Приветствие ==========

  Сценарий: Команда /start отправляет приветствие
    Допустим новый пользователь "Мария" отправил /start
    Когда бот обрабатывает команду
    Тогда бот отправляет приветствие с именем "Мария"
    И бот задаёт уточняющие вопросы
    И бот рекомендует линейку Relaxio Premium

  # ========== AI-ответы ==========

  Сценарий: Генерация AI-ответа на вопрос о цене
    Допустим пользователь спрашивает "Сколько стоит массажное кресло?"
    Когда бот генерирует AI-ответ
    Тогда ответ содержит информацию о линейке продуктов
    И ответ не превышает разумную длину

  Сценарий: AI использует системный промпт
    Когда формируются сообщения для AI
    Тогда первое сообщение имеет роль "system"
    И системный промпт содержит "Relaxio"

  Сценарий: История диалога передаётся в AI
    Допустим в истории есть 3 сообщения пользователя
    И 3 ответа бота
    Когда формируются сообщения для AI
    Тогда сообщения содержат историю диалога
    И роли чередуются между "user" и "assistant"

  # ========== Обработка ошибок ==========

  Сценарий: Ошибка AI возвращает fallback сообщение
    Допустим OpenAI API недоступен
    Когда бот пытается сгенерировать ответ
    Тогда бот возвращает сообщение об ошибке
    И сообщение содержит "Извините"

  Сценарий: Переподключение к MySQL при потере соединения
    Допустим соединение с MySQL потеряно
    Когда бот пытается сохранить сообщение
    Тогда бот переподключается к базе данных
    И сообщение сохраняется успешно

  # ========== Линейка продуктов ==========

  Сценарий: Информация о модели R5
    Когда клиент спрашивает о бюджетной модели
    Тогда бот рекомендует Relaxio Premium R5
    И указывает цену до 120 тыс

  Сценарий: Информация о модели R7
    Когда клиент спрашивает о среднем сегменте
    Тогда бот рекомендует Relaxio Premium R7
    И указывает цену до 200 тыс
    И упоминает 4D-массаж и нулевую гравитацию

  Сценарий: Информация о модели R9
    Когда клиент спрашивает о топовой модели
    Тогда бот рекомендует Relaxio Premium R9
    И указывает цену до 300 тыс
    И упоминает все премиум функции

  # ========== Этапы продажи ==========

  Структура сценария: Этапы воронки продаж
    Допустим клиент находится на этапе "<этап>"
    Когда бот отвечает клиенту
    Тогда бот следует стратегии для этапа "<этап>"

    Примеры:
      | этап                    |
      | выявление потребностей  |
      | уточнение деталей       |
      | презентация модели      |
      | работа с возражениями   |
      | закрытие сделки         |

  # ========== Сценарии покупки: Типичные клиенты ==========

  Сценарий: Покупка для себя - офисный работник с болями в спине
    Допустим клиент "Алексей" работает в офисе 8+ часов
    И у него боли в пояснице и шее
    И бюджет до 200 тысяч рублей
    Когда клиент описывает свою проблему
    Тогда бот выявляет потребность в терапевтическом массаже
    И рекомендует модель R7 с функцией прогрева
    И акцентирует внимание на программах для спины и шеи

  Сценарий: Покупка в подарок родителям на юбилей
    Допустим клиент "Мария" ищет подарок для родителей
    И родителям 60+ лет
    И важна простота управления
    Когда клиент уточняет требования
    Тогда бот спрашивает о состоянии здоровья родителей
    И рекомендует модель с понятным пультом
    И упоминает возможность подарочной упаковки

  Сценарий: Покупка для загородного дома - премиум клиент
    Допустим клиент "Дмитрий" обустраивает спа-зону в коттедже
    И бюджет не ограничен
    И важен премиум внешний вид
    Когда клиент запрашивает топовые варианты
    Тогда бот презентует флагманскую модель R9
    И описывает все премиум функции
    И предлагает выбор цвета обивки

  Сценарий: Покупка для семьи - универсальное использование
    Допустим клиент "Елена" выбирает кресло для всей семьи
    И в семье люди разного роста от 155 до 190 см
    И кресло будут использовать 4 человека
    Когда клиент описывает ситуацию
    Тогда бот уточняет диапазон роста и веса
    И рекомендует модель с автоподстройкой под рост
    И упоминает про настройку профилей пользователей

  Сценарий: Спортсмен-любитель для восстановления после тренировок
    Допустим клиент "Игорь" занимается спортом 4 раза в неделю
    И нужно восстановление мышц после нагрузок
    И интересует глубокий массаж
    Когда клиент спрашивает о подходящей модели
    Тогда бот рекомендует модель с интенсивным 4D-массажем
    И упоминает программу для спортсменов
    И рассказывает о функции растяжки

  # ========== Сценарии работы с возражениями ==========

  Сценарий: Возражение "Слишком дорого"
    Допустим клиент заинтересован в модели R7
    Но говорит что цена 200 тысяч слишком высокая
    Когда бот обрабатывает возражение о цене
    Тогда бот предлагает рассрочку без переплаты
    И сравнивает стоимость с походами к массажисту
    И упоминает гарантию 3 года

  Сценарий: Возражение "Нужно подумать"
    Допустим клиент получил всю информацию о модели
    Но говорит что хочет подумать
    Когда бот обрабатывает возражение
    Тогда бот уточняет какие моменты вызывают сомнения
    И предлагает тест-драйв в шоуруме
    И сообщает о временной акции

  Сценарий: Возражение "У конкурентов дешевле"
    Допустим клиент сравнивает с китайскими аналогами
    И упоминает цену в 2 раза ниже
    Когда бот отвечает на сравнение с конкурентами
    Тогда бот объясняет разницу в качестве механизмов
    И упоминает про гарантийный сервис в России
    И предлагает изучить отзывы клиентов

  Сценарий: Возражение "Займёт много места"
    Допустим клиент живёт в квартире 45 кв.м
    И беспокоится о габаритах кресла
    Когда бот отвечает на возражение о размерах
    Тогда бот сообщает точные габариты модели
    И упоминает функцию складывания
    И предлагает помощь с замерами

  Сценарий: Возражение "Не уверен что буду пользоваться"
    Допустим клиент сомневается в регулярном использовании
    И боится что кресло будет пылиться
    Когда бот работает с этим возражением
    Тогда бот приводит статистику использования
    И рассказывает про напоминания в приложении
    И предлагает пробный период

  # ========== Сценарии закрытия сделки ==========

  Сценарий: Успешное закрытие с доставкой в Москву
    Допустим клиент выбрал модель R7 чёрного цвета
    И готов к покупке
    И находится в Москве
    Когда бот закрывает сделку
    Тогда бот уточняет адрес доставки
    И предлагает бесплатную доставку и сборку
    И запрашивает удобное время

  Сценарий: Закрытие с доставкой в регион
    Допустим клиент из Новосибирска выбрал модель
    И готов оформить заказ
    Когда бот обрабатывает региональный заказ
    Тогда бот рассчитывает стоимость доставки
    И сообщает сроки транспортировки
    И предлагает страховку груза

  Сценарий: Оформление рассрочки
    Допустим клиент хочет модель R9 за 280 тысяч
    И просит рассрочку на 12 месяцев
    Когда бот оформляет рассрочку
    Тогда бот рассчитывает ежемесячный платёж
    И объясняет условия без переплаты
    И запрашивает данные для заявки

  Сценарий: Корпоративная продажа в офис
    Допустим клиент представляет компанию
    И хочет купить 3 кресла для комнаты отдыха
    Когда бот обрабатывает B2B запрос
    Тогда бот предлагает корпоративную скидку
    И уточняет реквизиты для счёта
    И предлагает расширенную гарантию

  # ========== Особые случаи ==========

  Сценарий: Клиент с ограниченными возможностями
    Допустим клиент покупает кресло для человека с артритом
    И нужен щадящий массаж
    Когда бот консультирует по специальным потребностям
    Тогда бот рекомендует модель с регулировкой интенсивности
    И упоминает про воздушно-компрессионный массаж
    И советует консультацию с врачом

  Сценарий: Возврат клиента после долгого раздумья
    Допустим клиент общался 2 недели назад
    И вернулся с решением о покупке
    Когда бот распознаёт возвращение клиента
    Тогда бот приветствует по имени
    И напоминает выбранную ранее модель
    И проверяет актуальность акций

  Сценарий: Клиент хочет сравнить все модели
    Допустим клиент просит сравнительную таблицу
    И не определился с бюджетом
    Когда бот формирует сравнение
    Тогда бот отправляет краткую сводку по моделям
    И выделяет ключевые отличия
    И предлагает помощь в выборе

  Сценарий: Негативный отзыв о предыдущем опыте
    Допустим клиент жалуется на плохой опыт с другим брендом
    И настроен скептически
    Когда бот работает со скептиком
    Тогда бот выражает понимание
    И объясняет отличия Relaxio
    И предлагает демонстрацию в шоуруме

  # ========== Ночные и выходные сценарии ==========

  Сценарий: Обращение в нерабочее время
    Допустим клиент пишет в 3 часа ночи
    Когда бот отвечает на ночное сообщение
    Тогда бот консультирует как обычно
    И предупреждает о времени обратного звонка
    И предлагает оставить контакт для менеджера

  Сценарий: Срочный заказ перед праздником
    Допустим до Нового года осталось 5 дней
    И клиент хочет успеть получить кресло в подарок
    Когда бот обрабатывает срочный заказ
    Тогда бот проверяет наличие на складе
    И предлагает экспресс-доставку
    И сообщает крайний срок оформления
